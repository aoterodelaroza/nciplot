      THRD4=4.D0/3.D0
      THRD5=5.D0/3.D0
      CEX=1.5D0*(0.75D0/PI)**(1.D0/3.D0)
      CTAU=0.6D0*(6.D0*PI*PI)**(2.D0/3.D0)
      CGEA=7.D0/(432D0*PI*(6.D0*PI*PI)**(1.D0/3.D0))
C
C
      DO 300 KKK=1,NNN
C
C     SPIN 1:
      DRHOSQ=4.D0*RHOS(KKK,1)*WEIZS(KKK,1)
      DRHO=DSQRT(DRHOSQ)
      RHO43=RHOS(KKK,1)**THRD4
      DLSS=DRHO/RHO43
      XL=-CEX*RHO43
      EXL=EXL+WINTS(KKK)*XL
      DLSS2=DLSS*DLSS
      X86=XL-0.00336D0*DRHO*DLSS/(1.D0+0.00449D0*DLSS2)
      EX86=EX86+WINTS(KKK)*X86
      ASNH=DLOG(DLSS+DSQRT(DLSS**2+1.D0))
      X88=XL-0.0042D0*DRHO*DLSS/(1.D0+6.D0*0.0042D0*DLSS*ASNH)
      EX88=EX88+WINTS(KKK)*X88
      RFG1=-0.5D0*RHOS(KKK,1)/X88
      Z11=0.88D0*2.D0*RFG1
      C8811=-0.01D0*RHOS(KKK,1)*DSIGS(KKK,1)*Z11**4*(1.D0-2.D0/Z11*
     C                                          DLOG(1.D0+0.5D0*Z11))
      EC8811=EC8811+WINTS(KKK)*C8811
      
C     SPIN 2:
      DRHOSQ=4.D0*RHOS(KKK,2)*WEIZS(KKK,2)
      DRHO=DSQRT(DRHOSQ)
      RHO43=RHOS(KKK,2)**THRD4
      DLSS=DRHO/RHO43
      XL=-CEX*RHO43
      EXL=EXL+WINTS(KKK)*XL
      DLSS2=DLSS*DLSS
      X86=XL-0.00336D0*DRHO*DLSS/(1.D0+0.00449D0*DLSS2)
      EX86=EX86+WINTS(KKK)*X86
      ASNH=DLOG(DLSS+DSQRT(DLSS**2+1.D0))
      X88=XL-0.0042D0*DRHO*DLSS/(1.D0+6.D0*0.0042D0*DLSS*ASNH)
      EX88=EX88+WINTS(KKK)*X88
      RFG2=-0.5D0*RHOS(KKK,2)/X88
      Z22=0.88D0*2.D0*RFG2
      C8822=-0.01D0*RHOS(KKK,2)*DSIGS(KKK,2)*Z22**4*(1.D0-2.D0/Z22*
     C                                          DLOG(1.D0+0.5D0*Z22))
      EC8811=EC8811+WINTS(KKK)*C8822
      
C     OPP SPINS:
      DROTX(KKK)=0.5D0*DRHOXA(KKK)+0.5D0*DRHOXB(KKK)
      DROTY(KKK)=0.5D0*DRHOYA(KKK)+0.5D0*DRHOYB(KKK)
      DROTZ(KKK)=0.5D0*DRHOZA(KKK)+0.5D0*DRHOZB(KKK)
      Z12=0.63D0*(RFG1+RFG2)
      C8812=-0.8D0*RHOS(KKK,1)*RHOS(KKK,2)*Z12**2*(1.D0-DLOG(1.D0+Z12)
     C        /Z12)
      EC8812=EC8812+WINTS(KKK)*C8812

      ZET=(RHOS(KKK,1)-RHOS(KKK,2))/(RHOS(KKK,1)+RHOS(KKK,2))
      DROT=2.D0*DSQRT(DROTX(KKK)**2+DROTY(KKK)**2+DROTZ(KKK)**2)
      CALL GASCOR(RHOS(KKK,1),RHOS(KKK,2),ECOR0,DUM1,DUM2,UCOR0)
      ECL=ECL+WINTS(KKK)*ECOR0
      CALL PERDC(RHOS(KKK,1),RHOS(KKK,2),DROT,ZET,CPBE)
      ECPBE=ECPBE+WINTS(KKK)*CPBE

300   CONTINUE
      RETURN
      END
C
C
      SUBROUTINE GASCOR(RHO1,RHO2,ECOR,VC1,VC2,UCOR)
      IMPLICIT REAL*8(A-H,O-Z)
      COMMON/PI/PI
      COMMON/EPS/EPS
      DATA PGAM,PFZZ/0.5198421D0,1.709921D0/
      THRD=1.D0/3.D0
      THRD4=4.D0*THRD
C**** PW91 CORRELATION LSDA,
      PRS = (0.75D0/PI/(RHO1+RHO2+EPS))**THRD
      PZET = (RHO1-RHO2)/(RHO1+RHO2+EPS)/(1.D0+EPS)
      PF = ((1.D0+PZET)**THRD4+(1.D0-PZET)**THRD4-2.D0)/PGAM
      PA = 0.0310907D0
      PA1 = 0.21370D0
      PB1 = 7.5957D0
      PB2 = 3.5876D0
      PB3 = 1.6382D0
      PB4 = 0.49294D0
      PP = 1.00D0
      PP1 = PP + 1.D0
      PQ0 = -2.D0*PA*(1.D0+PA1*PRS)
      PRS12 = DSQRT(PRS)
      PRS32 = PRS12**3
      PRSP = PRS**PP
      PQ1 = 2.D0*PA*(PB1*PRS12+PB2*PRS+PB3*PRS32+PB4*PRS*PRSP)
      PQ2 = DLOG(1.D0+1.D0/PQ1)
      PEU = PQ0*PQ2
      PQ3 = PA*(PB1/PRS12+2.D0*PB2+3.D0*PB3*PRS12+2.D0*PB4*PP1*PRSP)
      PEURS = -2.D0*PA*PA1*PQ2-PQ0*PQ3/(PQ1**2+PQ1)
      PA = 0.01554535D0
      PA1 = 0.20548D0
      PB1 = 14.1189D0
      PB2 = 6.1977D0
      PB3 = 3.3662D0
      PB4 = 0.62517D0
      PP = 1.00D0
      PP1 = PP + 1.D0
      PQ0 = -2.D0*PA*(1.D0+PA1*PRS)
      PRSP = PRS**PP
      PQ1 = 2.D0*PA*(PB1*PRS12+PB2*PRS+PB3*PRS32+PB4*PRS*PRSP)
      PQ2 = DLOG(1.D0+1.D0/PQ1)
      PEP = PQ0*PQ2
      PQ3 = PA*(PB1/PRS12+2.D0*PB2+3.D0*PB3*PRS12+2.D0*PB4*PP1*PRSP)
      PEPRS = -2.D0*PA*PA1*PQ2-PQ0*PQ3/(PQ1**2+PQ1)
      PA = 0.0168869D0
      PA1 = 0.11125D0
      PB1 = 10.357D0
      PB2 = 3.6231D0
      PB3 = 0.88026D0
      PB4 = 0.49671D0
      PP = 1.00D0
      PP1 = PP + 1.D0
      PQ0 = -2.D0*PA*(1.D0+PA1*PRS)
      PRSP = PRS**PP
      PQ1 = 2.D0*PA*(PB1*PRS12+PB2*PRS+PB3*PRS32+PB4*PRS*PRSP)
      PQ2 = DLOG(1.D0+1.D0/PQ1)
      PALFM = PQ0*PQ2
      PQ3 = PA*(PB1/PRS12+2.D0*PB2+3.D0*PB3*PRS12+2.D0*PB4*PP1*PRSP)
      ALFRSM = -2.D0*PA*PA1*PQ2-PQ0*PQ3/(PQ1**2+PQ1)
      PALFC = -PALFM
      PZ4 = PZET**4
      PEC = PEU*(1.D0-PF*PZ4)+PEP*PF*PZ4-PALFM*PF*(1.D0-PZ4)/PFZZ
       ECOR = (RHO1+RHO2) * PEC
      PECRS = PEURS*(1.D0-PF*PZ4)+PEPRS*PF*PZ4-ALFRSM*PF*(1.D0-PZ4)/PFZZ
      PFZ = THRD4*((1.D0+PZET)**THRD-(1.D0-PZET)**THRD)/PGAM
      PECZET = 4.D0*(PZET**3)*PF*(PEP-PEU+PALFM/PFZZ)+PFZ*(PZ4*PEP-PZ4
     1         *PEU-(1.D0-PZ4)*PALFM/PFZZ)
      PCOMM = PEC -PRS*PECRS/3.D0-PZET*PECZET
       VC1 = PCOMM + PECZET
       VC2 = PCOMM - PECZET
C**** END PW91 CORRELATION LSDA.
      PTC = -4.D0*PEC + 1.5D0*((1.D0+PZET)* VC1+(1.D0-PZET)* VC2)
      PTCOR = (RHO1+RHO2) * PTC
       UCOR =   ECOR-PTCOR
C**** END PW91 CORRELATION KINETIC AND POTENTIAL ENERGIES.
      RETURN
      END
C
C
      SUBROUTINE PERDC(RHO1,RHO2,DROT,ZET,CPBE)
      IMPLICIT REAL*8(A-H,O-Z)
      COMMON/PI/PI,FOURPI
      ROT=RHO1+RHO2
      CALL GASCOR(RHO1,RHO2,ECOR,VC1,VC2,UCOR)
      THRD=1.D0/3.D0
      THRD2=2.D0/3.D0
      FERMIK=(3.D0*PI*PI)**(1.D0/3.D0)
      PHI=0.5D0*((1.D0+ZET)**THRD2+(1.D0-ZET)**THRD2)
      PKF=FERMIK*ROT**THRD
      PKS=DSQRT(4.D0*PKF/PI)
      T=DROT/(2.D0*PHI*PKS*ROT)
      A=2.14612D0/(DEXP(-ECOR/ROT/0.031091D0/PHI**3)-1.D0)
      TSTUFF=(1.D0+A*T**2)/(1.D0+A*T**2+A**2*T**4)
      H=0.031091D0*PHI**3*DLOG(1.D0+2.14612D0*T**2*TSTUFF)
      CPBE=ECOR+ROT*H
      RETURN
      END

